# ğŸ“Š ç›‘æ§å‘Šè­¦é¢è¯•é¢˜

> é€‚åˆï¼šSREå·¥ç¨‹å¸ˆã€è¿ç»´å¼€å‘ã€ç›‘æ§å·¥ç¨‹å¸ˆ
> éš¾åº¦ï¼šâ­â­â­â­ (ä¸­çº§-é«˜çº§)

## ğŸ“‹ ç›‘æ§ç³»ç»Ÿè®¾è®¡

### 1. Prometheusæ¶æ„

```yaml
# æ ¸å¿ƒç»„ä»¶
- Prometheus Serverï¼šæ—¶åºæ•°æ®åº“å’ŒæŸ¥è¯¢å¼•æ“
- AlertManagerï¼šå‘Šè­¦è·¯ç”±å’Œé€šçŸ¥
- Grafanaï¼šæ•°æ®å¯è§†åŒ–å’Œä»ªè¡¨æ¿
- Pushgatewayï¼šæ¨é€æŒ‡æ ‡æ¥æ”¶å™¨

# é«˜å¯ç”¨è®¾è®¡
- Prometheusé›†ç¾¤åŒ–éƒ¨ç½²
- æ•°æ®åˆ†ç‰‡å’Œè”é‚¦é›†ç¾¤
- è¿œç¨‹å­˜å‚¨ï¼šThanos/Cortex
- è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»
```

### 2. ç›‘æ§æŒ‡æ ‡ä½“ç³»

#### é»„é‡‘ä¿¡å· (Golden Signals)
- **å»¶è¿Ÿ (Latency)**: å“åº”æ—¶é—´ã€P95/P99
- **æµé‡ (Traffic)**: QPSã€å¹¶å‘è¿æ¥æ•°
- **é”™è¯¯ç‡ (Error Rate)**: 4xx/5xxé”™è¯¯
- **é¥±å’Œåº¦ (Saturation)**: èµ„æºä½¿ç”¨ç‡

#### ç›‘æ§å±‚æ¬¡
```
ä¸šåŠ¡ç›‘æ§ï¼šç”¨æˆ·æ´»è·ƒåº¦ã€ä¸šåŠ¡è½¬åŒ–ç‡
åº”ç”¨ç›‘æ§ï¼šåº”ç”¨æ€§èƒ½ã€ä¸šåŠ¡æŒ‡æ ‡
åŸºç¡€è®¾æ–½ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
```

### 3. å‘Šè­¦ç­–ç•¥è®¾è®¡

#### å‘Šè­¦åˆ†ç±»
- **P0**: ä¸¥é‡æ•…éšœï¼Œç«‹å³å“åº”
- **P1**: é‡è¦é—®é¢˜ï¼Œ1å°æ—¶å†…å“åº”
- **P2**: ä¸€èˆ¬é—®é¢˜ï¼Œ4å°æ—¶å†…å“åº”
- **P3**: è½»å¾®é—®é¢˜ï¼Œ24å°æ—¶å†…å“åº”

#### å‘Šè­¦è§„åˆ™ä¼˜åŒ–
```yaml
# é¿å…å‘Šè­¦é£æš´
groups:
- name: web-alerts
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "High error rate detected"
```

## ğŸ“‹ å¯è§‚æµ‹æ€§

### 4. ä¸‰å¤§æ”¯æŸ±

#### Metricsï¼ˆæŒ‡æ ‡ï¼‰
```prometheus
# è®¡æ•°å™¨
http_requests_total

# ç›´æ–¹å›¾
http_request_duration_seconds

# ä»ªè¡¨ç›˜
cpu_usage_percent
```

#### Logsï¼ˆæ—¥å¿—ï¼‰
```json
{
  "timestamp": "2024-01-01T12:00:00Z",
  "level": "ERROR",
  "message": "Database connection failed",
  "trace_id": "abc123",
  "user_id": "user456"
}
```

#### Tracesï¼ˆè¿½è¸ªï¼‰
```yaml
# OpenTelemetryé…ç½®
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
exporters:
  jaeger:
    endpoint: jaeger:14250
```

### 5. æ··æ²Œå·¥ç¨‹

#### æ•…éšœæ³¨å…¥ç±»å‹
- **ç½‘ç»œæ•…éšœ**: å»¶è¿Ÿã€ä¸¢åŒ…ã€åˆ†åŒº
- **æœåŠ¡æ•…éšœ**: æœåŠ¡ä¸å¯ç”¨ã€å“åº”ç¼“æ…¢
- **åŸºç¡€è®¾æ–½æ•…éšœ**: èŠ‚ç‚¹å®•æœºã€ç£ç›˜æ»¡
- **ä¾èµ–æ•…éšœ**: æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—

#### å·¥å…·é€‰æ‹©
```bash
# Chaos Monkey
chaos-monkey --target-service web-app --failure-type latency

# Litmus
kubectl apply -f pod-delete-chaos.yaml

# Gremlin
gremlin attack-create shutdown --length 60 --target-type host
```

## ğŸ“‹ ç›‘æ§å®è·µ

### 6. Prometheus vs OpenFalcon

| ç‰¹æ€§ | Prometheus | OpenFalcon |
|------|------------|------------|
| æ¶æ„ | æ‹‰å–æ¨¡å¼ | æ¨é€æ¨¡å¼ |
| å­˜å‚¨ | è‡ªç ”æ—¶åºæ•°æ®åº“ | RRDæ ¼å¼ |
| æŸ¥è¯¢ | PromQL | ç®€å•æŸ¥è¯¢æ¥å£ |
| ç”Ÿæ€ | CNCFé¡¹ç›® | å°ç±³å¼€æº |

### 7. ç›‘æ§æŒ‡æ ‡é‡çº§

```
ç³»ç»ŸæŒ‡æ ‡ï¼š1000+ æŒ‡æ ‡/èŠ‚ç‚¹
åº”ç”¨æŒ‡æ ‡ï¼š500+ æŒ‡æ ‡/æœåŠ¡
ä¸šåŠ¡æŒ‡æ ‡ï¼š200+ æŒ‡æ ‡/ä¸šåŠ¡çº¿
æ€»è®¡ï¼š10ä¸‡+ æŒ‡æ ‡/é›†ç¾¤
```

### 8. æ—¥å¿—æ¶æ„

```yaml
# ELK Stack
Elasticsearch: å­˜å‚¨å’Œæœç´¢
Logstash: æ•°æ®å¤„ç†
Kibana: å¯è§†åŒ–

# æ—¥å¿—é‡çº§
æ—¥å¢é‡: 100GB - 1TB/å¤©
æ€»å­˜å‚¨: 10TB - 100TB
ç´¢å¼•æ•°é‡: 100+ ç´¢å¼•
åˆ†ç‰‡æ•°é‡: 1000+ åˆ†ç‰‡
```

## ğŸ“‹ å‘Šè­¦ç®¡ç†

### 9. SLOæŒ‡æ ‡è®¾è®¡

```yaml
# SLIï¼ˆService Level Indicatorï¼‰
- å¯ç”¨æ€§ï¼šæœåŠ¡å¯ç”¨æ—¶é—´/æ€»æ—¶é—´
- å»¶è¿Ÿï¼šå“åº”æ—¶é—´åˆ†å¸ƒï¼ˆP50ã€P95ã€P99ï¼‰
- ååé‡ï¼šQPSã€å¹¶å‘ç”¨æˆ·æ•°
- é”™è¯¯ç‡ï¼š4xxã€5xxé”™è¯¯æ¯”ä¾‹

# SLOï¼ˆService Level Objectiveï¼‰
- å¯ç”¨æ€§ç›®æ ‡ï¼š99.9%ã€99.99%
- å»¶è¿Ÿç›®æ ‡ï¼šP95 < 200msã€P99 < 500ms
- é”™è¯¯ç‡ç›®æ ‡ï¼šé”™è¯¯ç‡ < 0.1%
```

### 10. ç›‘æ§ç³»ç»Ÿæ•…éšœæ’æŸ¥

```bash
# å¸¸è§æ•…éšœ
- Prometheus OOMï¼šå†…å­˜ä¸è¶³
- æ•°æ®ä¸¢å¤±ï¼šç£ç›˜ç©ºé—´ä¸è¶³
- å‘Šè­¦å»¶è¿Ÿï¼šç½‘ç»œæˆ–é…ç½®é—®é¢˜
- æŸ¥è¯¢è¶…æ—¶ï¼šæ•°æ®é‡è¿‡å¤§

# æ’æŸ¥æ–¹æ³•
- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- æŸ¥çœ‹æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
- éªŒè¯é…ç½®å’Œç½‘ç»œè¿æ¥
- æµ‹è¯•æ•°æ®é‡‡é›†å’ŒæŸ¥è¯¢
```

## ğŸ”— ç›¸å…³èµ„æº

- [Prometheuså®˜æ–¹æ–‡æ¡£](https://prometheus.io/docs/)
- [Grafanaæ–‡æ¡£](https://grafana.com/docs/)
- [OpenTelemetry](https://opentelemetry.io/)

## ğŸ“ å¤ä¹ è¦ç‚¹

1. **æŒæ¡Prometheusæ¶æ„å’Œéƒ¨ç½²**
2. **ç†è§£ç›‘æ§æŒ‡æ ‡ä½“ç³»è®¾è®¡**
3. **å­¦ä¼šå‘Šè­¦ç­–ç•¥é…ç½®**
4. **ç†Ÿæ‚‰å¯è§‚æµ‹æ€§ä¸‰å¤§æ”¯æŸ±**
5. **å®è·µæ··æ²Œå·¥ç¨‹å’Œæ•…éšœæ’æŸ¥**
